<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layout/default_layout">
<head>
<meta charset="UTF-8">
<title>회원가입</title>
<script>

	function validatePassword() {
		if (document.querySelector('#password').value !== document.querySelector('#confirm-password').value) {
			confirmPassword.setCustomValidity('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
		} else {
			confirmPassword.setCustomValidity('');
		}
	}
		// 쿼리 셀렉터는 css 선택자를 그대로 가져와서 쓴다.
	function activateButton(btnId) {
		// 모든 버튼에서 active 클래스 제거
	    document.querySelectorAll('div[id^="btn_"]').forEach(btn => btn.classList.remove('active'));
	    // 선택한 버튼에 active 클래스 추가
	    document.getElementById(btnId).classList.add('active');
	    // input(gender) 값 변경
	    document.getElementById('gender').value = btnId.split('_')[1];
	}
	// 익명 함수
	$(() => {
		const password = document.querySelector('#password');
		const confirmPassword = document.querySelector('#confirm-password');
		password.addEventListener('input', validatePassword);
		confirmPassword.addEventListener('input', validatePassword);
		
		const yearSelect = document.getElementById("year");
	    const monthSelect = document.getElementById("month");
	    const daySelect = document.getElementById("day");
	    const currentYear = new Date().getFullYear();
	    
	    // 년도 옵션 생성
	    for (let i = currentYear - 100; i <= currentYear; i++) {
	        const option = document.createElement("option");
	        option.value = i;
	        option.textContent = i;
	        if (i == currentYear) option.selected = true;
	        yearSelect.appendChild(option);
	    }
	    
	    // 월 옵션 생성
	    for (let i = 1; i <= 12; i++) {
	        const option = document.createElement("option");
	        option.value = i;
	        option.textContent = i;
	        monthSelect.appendChild(option);
	    }
	    
	    // 일 옵션 생성
	    function updateDays() {
	        const year = yearSelect.value;
	        const month = monthSelect.value;
	        const daysInMonth = new Date(year, month, 0).getDate();
	    
	        daySelect.innerHTML = "";
	    
	        for (let i = 1; i <= daysInMonth; i++) {
	            const option = document.createElement("option");
	            option.value = i;
	            option.textContent = i;
	            daySelect.appendChild(option);
	        }
	    }
	    
	    yearSelect.addEventListener("change", updateDays);
	    monthSelect.addEventListener("change", updateDays);
	    updateDays();

	      $(document).ready(function () {
	    	  
	    	    $("#check-email").on("click", function () {
	    	        const email = $("#email").val();
	    	        if (!email) {
	    	            $("#email-result").text("이메일을 입력해주세요.");
	    	            return;
	    	        }

	    	        $.ajax({
	    	            type: "POST",
	    	            url: "/check-email",
	    	            data: {"email": email},
	    	            success: function (response) {
	    	                if (response.duplicate) {
	    	                    $("#email-result").text("이미 사용 중인 이메일입니다.");
	    	                    checkMail = false;
	    	                } else {
	    	                    $("#email-result").text("사용 가능한 이메일입니다.");
	    	                    checkMail = true;
	    	                }
	    	              
	    	            },
	    	            error: function () {
	    	              
	    	                $("#email-result").text("오류가 발생했습니다. 다시 시도해주세요.");
	    	                checkMail = false;
	                      
	    	            }
	    	        });
	    	    });
	    	} );
	      
	      $(document).ready(function () {
	    	  
	    	    $("#check-member_id").on("click", function () {
	    	        const member_id = $("#mem_id").val();
	    	        if (!member_id) {
	    	            $("#member_id-result").text("사용자 이름을 입력해주세요.");
	    	            return;
	    	        }

	    	        $.ajax({
	    	            type: "POST",
	    	            url: "/check-member_id",
	    	            data: {"mem_id": member_id},
	    	            success: function (response) {
	    	                if (response.duplicate) {
	    	                    $("#member_id-result").text("이미 사용 중인 사용자 이름입니다.");
	    	                    checkMemberId = false;
	    	                } else {
	    	                    $("#member_id-result").text("사용 가능한 사용자 이름입니다.");
	    	                    checkMemberId = true;
	    	                }
	    	              
	    	            },
	    	            error: function () {
	    	                $("#member_id-result").text("오류가 발생했습니다. 다시 시도해주세요.");
	    	                checkMemberId = false;
	    	            }
	    	        });
	    	    });
	    	} ); 
	});
	
	let checkMail = false;
    function resetCheckEmail() {
    	checkMail = false;
  	  $("#email-result").text("");
    }
    
	let checkMemberId = false;
    function resetCheckMemberId() {
  	  checkMemberId = false;
  	  $("#member_id-result").text("");
    }
    
    function checkForm(){
    	if(checkMail && checkMemberId) {
    		return true;
    	} else {
    		alert("회원가입 오류");
    		return false;
    	}
    }
    
</script>
<style>
* {
	box-sizing: border-box;
	font-family: Arial, Helvetica, sans-serif;
}

body {
	background-color: #f2f2f2;
}

.container {
	background-color: #ffffff;
	border-radius: 5px;
	padding: 20px;
	margin: 50px auto;
	max-width: 500px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

h1 {
	text-align: center;
	color: #333333;
}

input[type="text"], input[type="email"], input[type="password"] {
	width: 100%;
	padding: 12px;
	border: 1px solid #ccc;
	border-radius: 4px;
	margin-bottom: 16px;
	resize: vertical;
}
/** ^ 는 여기서부터 시작이다. $ 는 여기까지가 끝이다. **/
div[id^="btn_"] {
	display: inline-block;
	width: 80px;
	padding: 12px;
	border: 1px solid #ccc;
	border-radius: 4px;
	margin-bottom: 16px;
	resize: vertical;
}

label {
	font-weight: bold;
}

.submit-btn {
	background-color: #4CAF50;
	color: #ffffff;
	padding: 12px 20px;
	border: none;
	border-radius: 4px;
	cursor: pointer;
}

.submit-btn:hover {
	background-color: #45a049;
}

.active {
	background-color: green;
}
</style>
</head>
<body layout:fragment="section">

	<h2>회원가입</h2>
	<form action="join" method="post" th:object="${memberJoin}"
		onsubmit="return checkForm()">
		<table>
			<tr>
				<td><input type="email"
					th:field="*{mail}" id="email" name="email" placeholder="이메일 주소"
					onkeyup="resetCheckEmail()"> <sub class="email">이메일
						형식으로 입력해주세요. (예: mkfitness1423@naver.com)</sub>
					<button type="button" id="check-email">중복 확인</button> <span
					id="email-result"></span></td>
			</tr>

			<tr>
				<td>
					<input type="password" id="password" name="password"
					pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,16}$"
					placeholder="비밀번호" required
					oninvalid="setCustomValidity('비밀번호는 숫자, 알파벳 대소문자, 특수문자 중 최소 하나를 꼭 포함해 8자 이상 16자 이하로 입력해주세요.')"
					oninput="setCustomValidity('')">
					<sub class="password">숫자, 영어 대소문자, 특수문자(!@#$%^&*)를 최소 하나 이상 포함해 8자리 이상 16자리 이하 가능</sub>
				</td>

			</tr>

			<tr>
				<td><input type="password" id="confirm-password"
					name="confirm-password"
					pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*]).{8,16}$"
					placeholder="비밀번호 확인" required
					oninvalid="setCustomValidity('비밀번호는 숫자, 알파벳 대소문자, 특수문자 중 최소 하나를 꼭 포함해 8자 이상 16자 이하로 입력해주세요.')"
					oninput="setCustomValidity('')">
					<sub class="confirm-password">비밀번호를 다시 한 번 입력해주세요.</sub>
				</td>
			</tr>

			<tr>
				<td>
					<input type="text" name="name" placeholder="성명" th:field="*{name}" required>
				</td>
			</tr>

			<tr>
				<td><input type="text" name="member_id" placeholder="사용자 이름"
					th:field="*{mem_id}" pattern="[a-z0-9_\-\.]{4,16}"
					onkeyup="resetCheckMemberId()" required
					oninvalid="setCustomValidity('아이디는 4~16글자 안으로 소문자, 숫자, -,_,. 문자만 사용할 수 있습니다.')"
					oninput="setCustomValidity('')">
					<sub class="member_id">4자리 ~ 16자리로 영문 소문자, 숫자, 특수문자(_,-,.)만 사용할 수 있습니다.</sub>
					<button type="button" id="check-member_id">중복 확인</button> <span
					id="member_id-result"></span></td>
			</tr>
			<tr>
				<td>
					<div id="btn_male" class="pointer"
						onclick="activateButton('btn_male')">남성</div> <input type=hidden
					th:field="*{gender}">
					<div id="btn_female" class="pointer"
						onclick="activateButton('btn_female')">여성</div>
				</td>
			</tr>
			<tr>
				<td><label>생년월일 : </label> <select name="year" id="year">
				</select> <select name="month" id="month">
				</select> <select name="day" id="day">
				</select></td>
			</tr>
			<tr>
				<td><select id="phone1" name="phone1" th:field="*{phone1}">
						<option value="010">010</option>
						<option value="011">011</option>
						<option value="017">017</option>
						<option value="018">018</option>
						<option value="019">019</option>
				</select></td>
				<td><input type="text" id="phone2" name="phone2" maxlength="4"
					placeholder="0000" required th:field="*{phone2}">
				<td><input type="text" id="phone3" name="phone3" maxlength="4"
					placeholder="0000" required th:field="*{phone3}"></td>
			</tr>
		</table>
		<div>
			<input type="submit" value="회원가입">
		</div>
	</form>
</body>
</html>